generator client {
  provider = "prisma-client"
  output   = "../app/_generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  isValid       Boolean   @default(true)
  createdAt     DateTime  @default(now())

  accounts Account[]
  sessions Session[]
}

model Account {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String   @db.Uuid
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionToken String   @unique
  userId       String   @db.Uuid
  expires      DateTime
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TwitchFollow {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  channelId    String
  followerId   String
  followerName String
  followedAt   DateTime
  createdAt    DateTime @default(now())

  @@index([channelId])
  @@index([followedAt])
  @@map("twitch_follows")
}

model TwitchSubscription {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  channelId      String
  subscriberId   String
  subscriberName String
  isGift         Boolean  @default(false)
  gifterId       String?
  gifterName     String?
  isAnonymous    Boolean  @default(false)
  tier           String
  createdAt      DateTime @default(now())

  @@index([channelId])
  @@index([createdAt])
  @@map("twitch_subscriptions")
}

model TwitchCheer {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  channelId   String
  cheererId   String?
  cheererName String?
  bits        Int
  message     String?
  createdAt   DateTime @default(now())

  @@index([channelId])
  @@index([createdAt])
  @@map("twitch_cheers")
}

model TwitchStream {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  channelId  String
  type       String // "online" or "offline"
  streamType String? // "live", "playlist", etc. (only for online)
  startedAt  DateTime?
  createdAt  DateTime  @default(now())

  @@index([channelId])
  @@index([createdAt])
  @@map("twitch_streams")
}

model TwitchRaid {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  channelId  String // Who received the raid
  raiderId   String
  raiderName String
  viewers    Int
  createdAt  DateTime @default(now())

  @@index([channelId])
  @@index([createdAt])
  @@map("twitch_raids")
}

model TwitchRedemption {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  channelId    String
  redeemerId   String
  redeemerName String
  rewardId     String
  rewardTitle  String
  rewardCost   Int
  userInput    String?
  redeemedAt   DateTime
  createdAt    DateTime @default(now())

  @@index([channelId])
  @@index([createdAt])
  @@map("twitch_redemptions")
}

model TwitchChannelUpdate {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  channelId    String
  title        String
  categoryId   String
  categoryName String
  language     String
  createdAt    DateTime @default(now())

  @@index([channelId])
  @@index([createdAt])
  @@map("twitch_channel_updates")
}
